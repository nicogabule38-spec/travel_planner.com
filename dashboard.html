<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - A Journey 4 Life</title>
    <link rel="stylesheet" href="css/hover-animations.css">
    <style>
        .modal {
  display: none; 
  position: fixed; 
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.6);
}

/* Modal box */
.modal-content {
  background-color: white;
  margin: 10% auto;
  padding: 20px;
  border-radius: 15px;
  width: 50%;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  animation: fadeIn 0.3s ease-in-out;
}

/* Close button */
.close {
  float: right;
  font-size: 28px;
  cursor: pointer;
}

/* Itinerary items */
.itinerary-item {
  background: #f4f7ff;
  padding: 10px 15px;
  border-radius: 10px;
  margin-bottom: 10px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            text-decoration: none;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
            align-items: center;
        }
        
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        
        nav a:hover {
            color: #667eea;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .logout-btn {
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .logout-btn:hover {
            background: #c0392b;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .dashboard-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }
        
        .dashboard-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .main-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .widget {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .widget h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .saved-destinations {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .destination-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: transform 0.3s;
        }
        
        .destination-item:hover {
            transform: translateY(-2px);
        }
        
        .destination-icon {
            font-size: 2rem;
        }
        
        .destination-info h4 {
            margin-bottom: 5px;
            color: #333;
        }
        
        .destination-info p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: background 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn-secondary {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .recent-activity {
            list-style: none;
        }
        
        .recent-activity li {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .recent-activity li:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .activity-content h4 {
            margin-bottom: 5px;
            color: #333;
        }
        
        .activity-content p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .quick-action {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: background 0.3s;
            cursor: pointer;
        }
        
        .quick-action:hover {
            background: #e9ecef;
        }
        
        .quick-action-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .quick-action h4 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .quick-action p {
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            
            .dashboard-header h1 {
                font-size: 2rem;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo" style="display:flex; align-items:center; gap: 20px; text-decoration:none;">
                    <img src="images/Journey.png" alt="A Journey 4 Life" style="height: 60px; width:auto;"/>
                    <span>A Journey 4 Life</span>
                </a>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="destinations.html">Destinations</a></li>
                        <li><a href="itineraries.html">Itineraries</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li class="user-menu">
                            <div class="user-info">
                                <div class="user-avatar" id="userAvatar">U</div>
                                <span id="userName">User</span>
                            </div>
                            <button class="logout-btn" onclick="logout()">Logout</button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="dashboard-header">
                <h1>Welcome back, <span id="welcomeName">User</span>!</h1>
                <p>Plan your next Philippine adventure</p>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card" onclick="scrollToSection('savedDestinationsSection')">
                    <div class="stat-icon">üìç</div>
                    <div class="stat-number" id="savedDestinations">0</div>
                    <div class="stat-label">Saved Destinations</div>
                </div>
                <div class="stat-card" id="savedItinerariesCard" style="cursor:pointer;">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-number" id="savedItineraries">0</div>
                    <div class="stat-label">Saved Itineraries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-number" id="reviewsGiven">0</div>
                    <div class="stat-label">Reviews Given</div>
                </div>
                <div class="stat-card" id="totalTripsCard" style="cursor:pointer;">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-number" id="totalTrips">0</div>
                    <div class="stat-label">Total Trips</div>
                </div>
            </div>
            
            <div class="dashboard-content">
                <div class="main-content">
                    <h2>Your Travel Journey</h2>
                    <p style="margin-bottom: 30px; color: #666;">Track your travel progress and discover new adventures in the Philippines.</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <a href="destinations.html" class="btn">Explore Destinations</a>
                        <a href="itineraries.html" class="btn btn-secondary">Create Itinerary</a>
                    </div>
                    
                    <div id="savedDestinationsList" class="saved-destinations">
                        <div style="display:flex; align-items:center; justify-content:space-between;">
                            <h3 id="savedDestinationsSection" style="margin:0;">Your Saved Destinations</h3>
                            <button onclick="loadUserData()" style="padding:6px 16px; background:#667eea; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold; font-size:1rem;">Refresh</button>
                        </div>
                        <div id="noDestinations" style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">üìç</div>
                            <p>No saved destinations yet. Start exploring!</p>
                            <a href="destinations.html" class="btn" style="margin-top: 20px;">Browse Destinations</a>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar">
                    <div class="widget">
                        <h3>Quick Actions</h3>
                        <div class="quick-actions">
                            <div class="quick-action" onclick="createItinerary()">
                                <div class="quick-action-icon">üìù</div>
                                <h4>Create Itinerary</h4>
                                <p>Plan your trip</p>
                            </div>
                            <div class="quick-action" onclick="findDestinations()">
                                <div class="quick-action-icon">üîç</div>
                                <h4>Find Destinations</h4>
                                <p>Discover places</p>
                            </div>
                            <div class="quick-action" onclick="shareExperience()">
                                <div class="quick-action-icon">üì§</div>
                                <h4>Share Experience</h4>
                                <p>Tell your story</p>
                            </div>
                            <div class="quick-action" onclick="getRecommendations()">
                                <div class="quick-action-icon">üí°</div>
                                <h4>Get Recommendations</h4>
                                <p>Personalized tips</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="widget">
                        <h3>Recent Activity</h3>
                        <ul class="recent-activity" id="recentActivity">
                            <li>
                                <div class="activity-icon">üéâ</div>
                                <div class="activity-content">
                                    <h4>Welcome to A Journey 4 Life!</h4>
                                    <p>You've successfully created your account</p>




                                    <div id="itineraryModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>üóìÔ∏è Your Saved Itineraries</h2>

    <div id="itineraryList">
      <div class="itinerary-item">
        <h3>Bohol Adventure</h3>
        <p>3 Days ¬∑ Visit Chocolate Hills, Panglao Beach, and Loboc River Cruise</p>
      </div>

      <div class="itinerary-item">
        <h3>Palawan Escape</h3>
        <p>4 Days ¬∑ Explore El Nido lagoons and Puerto Princesa Underground River</p>
      </div>
    </div>
  </div>
</div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Check if user is logged in
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) {
            window.location.href = 'login.html';
        }
        
        // Update user info
        document.getElementById('userName').textContent = user.name;
        document.getElementById('welcomeName').textContent = user.name;
        document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
        
        // Load user data
        function loadUserData() {
            // Load saved destinations and itineraries from localStorage
            const savedDestinations = JSON.parse(localStorage.getItem('savedDestinations') || '[]');
            const savedItineraries = JSON.parse(localStorage.getItem('savedItineraries') || '[]');
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');

            // Filter items that belong to the current user
            const userDestinations = savedDestinations.filter(d => d.userId === user.id);
            const userItineraries = savedItineraries.filter(i => i.userId === user.id);
            const userReviews = reviews.filter(r => r.userId === user.id);

            // Update stats
            document.getElementById('savedDestinations').textContent = userDestinations.length;
            document.getElementById('savedItineraries').textContent = userItineraries.length;
            document.getElementById('reviewsGiven').textContent = userReviews.length;
            document.getElementById('totalTrips').textContent = userItineraries.length;

            // Display saved destinations for this user
            displaySavedDestinations(userDestinations);

            // Wire saved itineraries stat card to open modal with user's itineraries
            const card = document.getElementById('savedItinerariesCard');
            if (card) card.addEventListener('click', () => openSavedItinerariesModal(userItineraries));

            const totalTripsCard = document.getElementById('totalTripsCard');
            if (totalTripsCard) totalTripsCard.addEventListener('click', () => openSavedItinerariesModal(userItineraries));

            // Wire reviews stat card to open reviews modal
            const reviewsCard = document.getElementById('reviewsGivenCard');
            if (reviewsCard) reviewsCard.addEventListener('click', () => openReviewsModal(userReviews));
        }

        // Open modal showing user's reviews and allow delete
        function openReviewsModal(reviews) {
            const existing = document.getElementById('reviewsModal');
            if (existing) existing.remove();

            const modal = document.createElement('div');
            modal.id = 'reviewsModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-height:80vh;overflow:auto;">
                    <span class="close" onclick="document.getElementById('reviewsModal').remove()">&times;</span>
                    <h2>‚≠ê Your Reviews</h2>
                    <div id="reviewsList" style="margin-top:12px;display:flex;flex-direction:column;gap:12px;">` +
                        (reviews.length === 0 ? '<p style="color:#666;">You have not posted any reviews yet.</p>' : reviews.map(r => `
                            <div style="background:#f8f9fa;padding:12px;border-radius:8px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
                                    <div style="font-weight:700;color:#333;">${r.destination || 'Untitled'}</div>
                                    <div style="color:#667eea;font-weight:700;">${'‚≠ê'.repeat(r.rating||0)}</div>
                                </div>
                                <div style="color:#666;margin-top:8px;">${r.comment || ''}</div>
                                <div style="color:#999;font-size:0.85rem;margin-top:8px;">${r.travelDate ? new Date(r.travelDate).toLocaleDateString() : (r.createdAt? new Date(r.createdAt).toLocaleString() : '')}</div>
                                <div style="margin-top:10px;text-align:right;">
                                    <button onclick="editReview(${r.id})" style="background:#3498db;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;margin-right:8px;">Edit</button>
                                    <button onclick="deleteReview(${r.id})" style="background:#e74c3c;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;">Delete</button>
                                </div>
                            </div>
                        `).join('')) + `
                    </div>
                </div>`;

            document.body.appendChild(modal);
            modal.style.display = 'block';
        }

        function addReview(destination, rating, comment) {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (!user.id) {
                alert('Please log in to add a review');
                return;
            }

            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const newReview = {
                id: Date.now(),
                userId: user.id,
                userName: user.name,
                destination: destination,
                rating: rating,
                comment: comment,
                createdAt: new Date().toISOString()
            };
            reviews.push(newReview);
            localStorage.setItem('reviews', JSON.stringify(reviews));
            loadUserData();
            return newReview;
        }

        function editReview(id) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const review = reviews.find(r => r.id === id);
            if (!review) return;

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    <h2>Edit Review</h2>
                    <div style="margin-top:20px;">
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;">Rating</label>
                            <div class="star-rating">
                                ${[1,2,3,4,5].map(num => `
                                    <span class="star ${num <= review.rating ? 'active' : ''}" data-rating="${num}">‚≠ê</span>
                                `).join('')}
                            </div>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;">Comment</label>
                            <textarea id="editComment" style="width:100%;min-height:100px;padding:8px;border-radius:4px;border:1px solid #ddd;">${review.comment || ''}</textarea>
                        </div>
                        <div style="text-align:right;">
                            <button onclick="saveReviewEdit(${id})" style="background:#2ecc71;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">Save Changes</button>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
            modal.style.display = 'block';

            // Wire up star rating
            const stars = modal.querySelectorAll('.star');
            let currentRating = review.rating;
            stars.forEach(star => {
                star.style.cursor = 'pointer';
                star.addEventListener('click', () => {
                    const rating = parseInt(star.dataset.rating);
                    currentRating = rating;
                    stars.forEach(s => {
                        const r = parseInt(s.dataset.rating);
                        s.classList.toggle('active', r <= rating);
                    });
                });
            });

            // Store current rating in the modal for access by save function
            modal.dataset.currentRating = currentRating;
        }

        function saveReviewEdit(id) {
            const modal = document.querySelector('.modal');
            const rating = parseInt(modal.dataset.currentRating);
            const comment = document.getElementById('editComment').value;
            
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const index = reviews.findIndex(r => r.id === id);
            if (index !== -1) {
                reviews[index] = {
                    ...reviews[index],
                    rating,
                    comment,
                    updatedAt: new Date().toISOString()
                };
                localStorage.setItem('reviews', JSON.stringify(reviews));
                modal.remove();
                // Refresh reviews modal
                const reviewsModal = document.getElementById('reviewsModal');
                if (reviewsModal) {
                    const userReviews = reviews.filter(r => r.userId === user.id);
                    openReviewsModal(userReviews);
                }
                loadUserData();
            }
        }

        function deleteReview(id) {
            if (!confirm('Delete this review?')) return;
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const filtered = reviews.filter(r => r.id !== id);
            localStorage.setItem('reviews', JSON.stringify(filtered));
            // refresh UI
            const modal = document.getElementById('reviewsModal');
            if (modal) modal.remove();
            loadUserData();
        }

        // Add rating UI to destination cards
        function addRatingUIToDestination(destinationName) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    <h2>Rate ${destinationName}</h2>
                    <div style="margin-top:20px;">
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;">Your Rating</label>
                            <div class="star-rating">
                                ${[1,2,3,4,5].map(num => `
                                    <span class="star" data-rating="${num}">‚≠ê</span>
                                `).join('')}
                            </div>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block;margin-bottom:5px;">Your Review</label>
                            <textarea id="reviewComment" style="width:100%;min-height:100px;padding:8px;border-radius:4px;border:1px solid #ddd;" placeholder="Share your experience..."></textarea>
                        </div>
                        <div style="text-align:right;">
                            <button onclick="submitReview('${destinationName}')" style="background:#2ecc71;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;">Submit Review</button>
                        </div>
                    </div>
                </div>`;

            document.body.appendChild(modal);
            modal.style.display = 'block';

            // Wire up star rating
            const stars = modal.querySelectorAll('.star');
            let currentRating = 0;
            stars.forEach(star => {
                star.style.cursor = 'pointer';
                star.addEventListener('click', () => {
                    const rating = parseInt(star.dataset.rating);
                    currentRating = rating;
                    stars.forEach(s => {
                        const r = parseInt(s.dataset.rating);
                        s.classList.toggle('active', r <= rating);
                    });
                });
            });

            // Store current rating in the modal for access by submit function
            modal.dataset.currentRating = currentRating;
        }

        function submitReview(destinationName) {
            const modal = document.querySelector('.modal');
            const rating = parseInt(modal.dataset.currentRating);
            const comment = document.getElementById('reviewComment').value;

            if (!rating) {
                alert('Please select a rating');
                return;
            }

            const review = addReview(destinationName, rating, comment);
            if (review) {
                modal.remove();
                alert('Thank you for your review!');
            }
        }

        // Open modal listing the user's saved itineraries
        function openSavedItinerariesModal(itineraries) {
            // Remove existing modal if any
            const existing = document.getElementById('savedItinerariesModal');
            if (existing) existing.remove();

            const modal = document.createElement('div');
            modal.id = 'savedItinerariesModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="document.getElementById('savedItinerariesModal').remove()">&times;</span>
                    <h2>üóìÔ∏è Your Saved Itineraries</h2>
                    <div id="savedItineraryList" style="margin-top:15px; max-height:60vh; overflow:auto;"></div>
                </div>`;

            document.body.appendChild(modal);
            const list = document.getElementById('savedItineraryList');
            if (!itineraries || itineraries.length === 0) {
                list.innerHTML = '<p style="color:#666;">You have no saved itineraries yet.</p>';
            } else {
                list.innerHTML = itineraries.map(i => `
                    <div class="itinerary-item">
                        <h3>${i.title}</h3>
                        <p><strong>Duration:</strong> ${i.duration}</p>
                        <p><strong>Budget:</strong> ‚Ç±${i.budget}</p>
                        <p><strong>Destinations:</strong> ${Array.isArray(i.destinations) ? i.destinations.join(', ') : i.destinations}</p>
                        <p style="font-size:0.85rem; color:#666;">Created: ${new Date(i.createdAt).toLocaleString()}</p>
                    </div>
                `).join('');
            }

            modal.style.display = 'block';
    }
        
        function displaySavedDestinations(destinations) {
            const container = document.getElementById('savedDestinationsList');
            const noDestinations = document.getElementById('noDestinations');
            
            if (destinations.length === 0) {
                noDestinations.style.display = 'block';
                return;
            }
            
            // hide empty state and clear previous items to avoid duplicates
            noDestinations.style.display = 'none';
            container.querySelectorAll('.destination-item').forEach(n => n.remove());
            
            destinations.forEach(destination => {
                const item = document.createElement('div');
                item.className = 'destination-item';
                item.innerHTML = `
                    <div class="destination-icon">${destination.icon || 'üìç'}</div>
                    <div class="destination-info">
                        <h4>${destination.name}</h4>
                        <p>${destination.location || ''}</p>
                        <p style="margin-top:6px; font-size:0.9rem;">${destination.description || ''}</p>
                        ${destination.bestTime ? `<p style="margin-top:6px; font-size:0.9rem;"><strong>Best Time:</strong> ${destination.bestTime}</p>` : ''}
                        ${destination.cost ? `<p style="margin-top:6px; font-size:0.9rem;"><strong>Cost:</strong> ${destination.cost}</p>` : ''}
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // Quick action functions
        function createItinerary() {
            window.location.href = 'itineraries.html';
        }
        
        function findDestinations() {
            window.location.href = 'destinations.html';
        }
        
        function shareExperience() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert('Please login to share your experience!');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'shareExperienceModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #333; margin: 0;">Share Your Travel Experience</h2>
                        <button onclick="closeShareExperienceModal()" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 18px;">√ó</button>
                    </div>
                    
                    <form id="shareExperienceForm">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Destination</label>
                            <select id="experienceDestination" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                                <option value="">Select Destination</option>
                                <option value="Boracay Island">Boracay Island</option>
                                <option value="Palawan">Palawan</option>
                                <option value="Banaue Rice Terraces">Banaue Rice Terraces</option>
                                <option value="Mayon Volcano">Mayon Volcano</option>
                                <option value="Intramuros">Intramuros</option>
                                <option value="Vigan">Vigan</option>
                            </select>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Rating</label>
                            <div style="display: flex; gap: 10px;">
                                <label><input type="radio" name="rating" value="1" required> ‚≠ê</label>
                                <label><input type="radio" name="rating" value="2" required> ‚≠ê‚≠ê</label>
                                <label><input type="radio" name="rating" value="3" required> ‚≠ê‚≠ê‚≠ê</label>
                                <label><input type="radio" name="rating" value="4" required> ‚≠ê‚≠ê‚≠ê‚≠ê</label>
                                <label><input type="radio" name="rating" value="5" required> ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</label>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Your Experience</label>
                            <textarea id="experienceComment" rows="4" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 500;">Travel Date</label>
                            <input type="date" id="travelDate" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px;">
                        </div>
                        
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeShareExperienceModal()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">Share Experience</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('shareExperienceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveExperience();
            });
        }
        
        function closeShareExperienceModal() {
            const modal = document.getElementById('shareExperienceModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function saveExperience() {
            const destination = document.getElementById('experienceDestination').value;
            const rating = document.querySelector('input[name="rating"]:checked').value;
            const comment = document.getElementById('experienceComment').value;
            const travelDate = document.getElementById('travelDate').value;
            
            const user = JSON.parse(localStorage.getItem('user'));
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            
            const newReview = {
                id: Date.now(),
                userId: user.id,
                userName: user.name,
                destination: destination,
                rating: parseInt(rating),
                comment: comment,
                travelDate: travelDate,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };
            
            reviews.push(newReview);
            localStorage.setItem('reviews', JSON.stringify(reviews));
            
            closeShareExperienceModal();
            alert('Thank you for sharing your experience! Your review will be reviewed by admin before being published.');
            loadUserData(); // Refresh dashboard data
        }
        
        function getRecommendations() {
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert('Please login to get personalized recommendations!');
                return;
            }
            
            const savedDestinations = JSON.parse(localStorage.getItem('savedDestinations') || '[]');
            const userDestinations = savedDestinations.filter(dest => dest.userId === user.id);
            
            if (userDestinations.length === 0) {
                alert('Save some destinations first to get personalized recommendations!');
                return;
            }
            
            // Generate recommendations based on saved destinations
            const recommendations = generateRecommendations(userDestinations);
            
            const modal = document.createElement('div');
            modal.id = 'recommendationsModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="color: #333; margin: 0;">Personalized Recommendations</h2>
                        <button onclick="closeRecommendationsModal()" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 18px;">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p style="color: #666;">Based on your saved destinations, here are some recommended itineraries:</p>
                    </div>
                    
                    <div id="recommendationsList">
                        ${recommendations.map(rec => `
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                                <h3 style="color: #333; margin-bottom: 10px;">${rec.title}</h3>
                                <p style="color: #666; margin-bottom: 10px;">${rec.description}</p>
                                <div style="margin-bottom: 10px;">
                                    <strong>Destinations:</strong> ${rec.destinations.join(', ')}
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <strong>Duration:</strong> ${rec.duration}
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>Budget:</strong> ${rec.budget}
                                </div>
                                <button onclick="createRecommendedItinerary('${rec.title}', '${rec.description}', '${rec.duration}', '${rec.budget}', '${rec.destinations.join(',')}')" style="padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">Create This Itinerary</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function generateRecommendations(userDestinations) {
            const allDestinations = ['Boracay Island', 'Palawan', 'Banaue Rice Terraces', 'Mayon Volcano','Mount Apo', 'Intramuros', 'Vigan'];
            const savedNames = userDestinations.map(dest => dest.name);
            const unsavedDestinations = allDestinations.filter(dest => !savedNames.includes(dest));
            
            const recommendations = [];
            
            // Beach lover recommendation
            if (savedNames.includes('Boracay Island') || savedNames.includes('Palawan')) {
                recommendations.push({
                    title: 'Ultimate Beach Paradise',
                    description: 'Explore more stunning beaches and islands based on your beach preferences.',
                    duration: '5 Days, 4 Nights',
                    budget: 'PHP 2,000 - 4,000',
                    destinations: ['Palawan', 'Boracay Island', 'El Nido']
                });
            }
            
            // Cultural heritage recommendation
            if (savedNames.includes('Banaue Rice Terraces') || savedNames.includes('Intramuros')) {
                recommendations.push({
                    title: 'Cultural Heritage Journey',
                    description: 'Discover more historical and cultural sites in the Philippines.',
                    duration: '7 Days, 6 Nights',
                    budget: 'PHP 1,500 - 3,000',
                    destinations: ['Banaue Rice Terraces', 'Intramuros', 'Vigan', 'Sagada']
                });
            }
            
            // Adventure recommendation
            if (savedNames.includes('Mayon Volcano') || savedNames.includes('Banaue Rice Terraces')) {
                recommendations.push({
                    title: 'Adventure & Nature Explorer',
                    description: 'Experience more natural wonders and adventure activities.',
                    duration: '10 Days, 9 Nights',
                    budget: 'PHP 2,500 - 5,000',
                    destinations: ['Mayon Volcano', 'Banaue Rice Terraces', 'Sagada', 'Palawan']
                });
            }
            
            // Mixed recommendation
            recommendations.push({
                title: 'Complete Philippines Experience',
                description: 'A comprehensive tour covering beaches, culture, and nature.',
                duration: '14 Days, 13 Nights',
                budget: 'PHP 5,000 - 10,000',
                destinations: ['Boracay Island', 'Palawan', 'Banaue Rice Terraces', 'Mayon Volcano', 'Intramuros', 'Vigan']
            });
            
            return recommendations.slice(0, 3); // Return top 3 recommendations
        }
        
        function closeRecommendationsModal() {
            const modal = document.getElementById('recommendationsModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function createRecommendedItinerary(title, description, duration, budget, destinations) {
            closeRecommendationsModal();
            
            // Pre-fill the itinerary creation form
            const user = JSON.parse(localStorage.getItem('user'));
            if (!user) {
                alert('Please login to create itineraries!');
                return;
            }
            
            const destinationArray = destinations.split(',');
            const itinerary = {
                id: Date.now(),
                userId: user.id,
                title: title,
                description: description,
                duration: duration,
                budget: budget,
                destinations: destinationArray,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };
            
            const savedItineraries = JSON.parse(localStorage.getItem('savedItineraries') || '[]');
            savedItineraries.push(itinerary);
            localStorage.setItem('savedItineraries', JSON.stringify(savedItineraries));
            
            alert(`Itinerary "${title}" has been created successfully!`);
            loadUserData(); // Refresh dashboard data
        }
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('user');
                window.location.href = 'index.html';
            }
        }
        
        // Load data on page load
        loadUserData();
    </script>
    <script>
  function scrollToSection(id) {
    const section = document.getElementById(id);
    if (section) {
      section.scrollIntoView({ behavior: "smooth" });
    }
  }
 </script>
 <script>
  function openModal() {
    document.getElementById("itineraryModal").style.display = "block";
  }

  function closeModal() {
    document.getElementById("itineraryModal").style.display = "none";
  }

  // Optional: close when clicking outside
  window.onclick = function(event) {
    const modal = document.getElementById("itineraryModal");
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>
<script>
    // Removed the incorrect window.addEventListener for loading itineraries
</script>
</body>
</html>
